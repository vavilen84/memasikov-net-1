$(document).ready(function(){new(Backbone.View.extend({el:".container",events:{"click .image-previews img":"changeImage","click .controls .next":"setNextImage","click .controls .prev":"setPrevImage","click .copy-image-link":"copyImageLink","click .image img":"setNextImage"},initialize:function(){this.setActivePreviewOnPageLoad(),this.addFirstLastPreviewClasses(),this.setGlobalCurrentImage(),this.bindMouseHoverOnMainImage()},bindMouseHoverOnMainImage:function(){var e=$(".controls-btn-wrap");$(".controls");e.hover(function(){$(".circle").removeClass("active"),$(this).find(".circle").addClass("active")},function(){$(".circle").removeClass("active")})},setGlobalCurrentImage:function(){Global.currentImage=$(".image-previews").find("img").first().attr("src")},copyImageLink:function(){document.getElementById("image-link").select(),document.execCommand("Copy");var e=$("#copy-link-button");e.text("Скопировано!").removeClass("btn-primary").addClass("btn-success"),setTimeout(function(){e.removeClass("btn-success").addClass("btn-primary").text("Скопировать ссылку на картинку")},1e3)},addFirstLastPreviewClasses:function(){$(".image-previews").find("img").first().addClass("first"),$(".image-previews").find("img").last().addClass("last")},setActivePreviewOnPageLoad:function(){var e=$("#lastImageActive").val(),a=$(".image-previews").find("img");if(1==e)var t=a.last();else var t=a.first();t.addClass("active")},setNextImage:function(){var e=this,a=$(".image-previews").find(".active").first();if(a){if(a.hasClass("last")){var t=$(".pagination").find(".active"),i=t.next();if(!$(i).hasClass("next")){var r=$(i).find("a").attr("data-page");r=parseInt(r),r++,e.redirectToNewPageOnChangeImage(r,!1)}return}var n=a.next(".image-previews > img");n&&($(".image-previews").find("img").removeClass("active"),n.addClass("active"))}this.setNewImage()},setNewImage:function(){var e=$(".image-previews").find(".active").first();this.setNewImageLinkData(e);var a=e.attr("src");Global.currentImage=a,this.setDownloadLinkData(a);var t=$(".image").find("img");t.attr("src",a),t.hasClass("author-image")&&this.changeAuthorImageData(t,e)},getCurrentTimestamp:function(){return(new Date).getTime()/1e3},setNewImageLinkData:function(e){var a=e.attr("data-number");if(a){var t=window.location.search?"&":"?";if(this.getParameterByName("currentImageNumber"))var i=this.replaceQueryParamValue("currentImageNumber",a);else var i=window.location.href+t+"currentImageNumber="+a;$("#image-link").val(i),Global.targetUrl=i,$("#current-image-number").text(a)}},setDownloadLinkData:function(e){$(".download-link").attr("href",e)},replaceQueryParamValue:function(e,a){return window.location.href.replace(/('+paramName+'=).*?(&)/,"$1"+a+"$2")},getParameterByName:function(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=t.exec(a);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},changeAuthorImageData:function(e,a){this.$el.find(".current-image-title").text(a.attr("data-title")),this.$el.find(".current-image-created-text").text(a.attr("data-created_text")),$(".author-page-link").attr("href",a.attr("data-author_page_url"));var t=window.location.search?"&":"?";if(this.getParameterByName("image"))var i=this.replaceQueryParamValue("image",a.attr("data-uid"));else var i=window.location.href+t+"image="+a.attr("data-uid");$("#image-link").val(i),Global.targetUrl=i},redirectToNewPageOnChangeImage:function(e,a){var t=window.location.origin+window.location.pathname;t+="?page="+e,a&&(t+="&lastImageActive=1"),window.location.href=t},setPrevImage:function(){var e=this,a=$(".image-previews").find(".active").first();if(a){if(a.hasClass("first")){var t=$(".pagination").find(".active"),i=t.prev();if(!$(i).hasClass("prev")){var r=$(i).find("a").attr("data-page");r=parseInt(r),r++,e.redirectToNewPageOnChangeImage(r,!0)}return}var n=a.prev(".image-previews > img");n&&($(".image-previews").find("img").removeClass("active"),n.addClass("active"))}this.setNewImage()},setActivePreview:function(){$(".image-previews").find("img").first().addClass("active")},changeImage:function(e){this.setActivePreview(e),this.setNewImage()},setActivePreview:function(e){$(".image-previews").find("img").removeClass("active"),$(e.currentTarget).addClass("active")}}))});